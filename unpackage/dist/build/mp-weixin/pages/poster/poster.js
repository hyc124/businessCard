(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/poster/poster"],{"0425":function(t,n,e){"use strict";e.d(n,"b",(function(){return a})),e.d(n,"c",(function(){return i})),e.d(n,"a",(function(){return o}));var o={uButton:function(){return e.e("uview-ui/components/u-button/u-button").then(e.bind(null,"1fd2"))},uSkeleton:function(){return e.e("uview-ui/components/u-skeleton/u-skeleton").then(e.bind(null,"4fdf"))}},a=function(){var t=this,n=t.$createElement;t._self._c},i=[]},"1f86":function(t,n,e){"use strict";e.r(n);var o=e("566d"),a=e.n(o);for(var i in o)"default"!==i&&function(t){e.d(n,t,(function(){return o[t]}))}(i);n["default"]=a.a},2240:function(t,n,e){"use strict";var o=e("dc4a"),a=e.n(o);a.a},"566d":function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=i(e("a34a")),a=i(e("ff13"));function i(t){return t&&t.__esModule?t:{default:t}}function r(t,n,e,o,a,i,r){try{var s=t[i](r),c=s.value}catch(u){return void e(u)}s.done?n(c):Promise.resolve(c).then(o,a)}function s(t){return function(){var n=this,e=arguments;return new Promise((function(o,a){var i=t.apply(n,e);function s(t){r(i,o,a,s,c,"next",t)}function c(t){r(i,o,a,s,c,"throw",t)}s(void 0)}))}}var c=function(){e.e("components/card/card").then(function(){return resolve(e("e55a"))}.bind(null,e)).catch(e.oe)},u={data:function(){return{cardInfo:{company_name:"xxx",position:"xxxx",username:"xxx",small_program_code_base64:""},palette:"",imagePath:"",loading:!0}},components:{card:c},computed:{customerId:function(){return this.$store.state.customerId}},created:function(){if(""==this.customerId){this.cardInfo=this.$store.state.cardInfo;var t=this.$store.state.isCreatPoster;if(""==this.cardInfo.posters)this.initData();else{if(t)return this.initData(),!1;this.imagePath=this.cardInfo.posters,this.loading=!1}}else this.getUserInfo()},methods:{getUserInfo:function(){var t=this;return s(o.default.mark((function n(){var e,a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$u.api.cardInfo({id:t.customerId});case 2:e=n.sent,a=e.data,t.cardInfo=a,t.initData();case 6:case"end":return n.stop()}}),n)})))()},initData:function(){t.showLoading({title:"拼命生成中...",mask:!0}),this.cardInfo.position&&this.cardInfo.main_department?this.cardInfo.positionInfo="".concat(this.cardInfo.position,"/").concat(this.cardInfo.main_department):this.cardInfo.main_department?this.cardInfo.positionInfo=this.cardInfo.main_department:this.cardInfo.positionInfo=this.cardInfo.position,this.palette=new a.default(this.cardInfo).palette()},onGenerateSuccess:function(n){var e=t.baseUrl,o=this;t.uploadFile({url:e+"/vcard/upload",filePath:n.detail.path,name:"img",header:{token:t.getStorageSync("token")},formData:{id:o.cardInfo.id,type:1},success:function(n){o.loading=!1,t.hideLoading();try{"string"==typeof n.data&&(n.data=JSON.parse(n.data)),o.imagePath=n.data.data.url,o.$store.commit("SetIsCreatPoster",!1),o.$store.dispatch("GetCardInfo")}catch(e){console.log(e)}},fail:function(){t.hideLoading(),o.showMsg("error","上传失败")}})},onGenerateError:function(n){t.hideLoading()},preview:function(){if(!this.imagePath)return!1;var n=[];n.push(this.imagePath),t.previewImage({urls:n,current:0})},saveImg:function(){var n=this;t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.downloadFile({url:n.imagePath,success:function(e){t.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(){t.showModal({title:"保存成功",content:"图片已成功保存到相册，你可以长按图片或去手机相册分享给好友",showCancel:!1,success:function(){var e=[];e.push(n.imagePath),t.previewImage({urls:e,current:0})}})}})}})},fail:function(t){t.errMsg.includes("authorize:fail")&&wx.showModal({title:"提示",content:"需要您授权保存相册",showCancel:!1,success:function(t){wx.openSetting({success:function(t){t.authSetting["scope.writePhotosAlbum"]?wx.showModal({title:"提示",content:"获取权限成功,再次点击图片即可保存",showCancel:!1}):wx.showModal({title:"提示",content:"获取权限失败，将无法保存到相册哦~",showCancel:!1})},fail:function(t){console.log("failData",t)},complete:function(t){console.log("finishData",t)}})}})}})}}};n.default=u}).call(this,e("543d")["default"])},"8b7c":function(t,n,e){"use strict";e.r(n);var o=e("0425"),a=e("1f86");for(var i in a)"default"!==i&&function(t){e.d(n,t,(function(){return a[t]}))}(i);e("2240");var r,s=e("f0c5"),c=Object(s["a"])(a["default"],o["b"],o["c"],!1,null,"e110f1fa",null,!1,o["a"],r);n["default"]=c.exports},cf48:function(t,n,e){"use strict";(function(t){e("4ee8");o(e("66fd"));var n=o(e("8b7c"));function o(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},dc4a:function(t,n,e){}},[["cf48","common/runtime","common/vendor"]]]);