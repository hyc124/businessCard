(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/qycode/qycode"],{"06a7":function(t,e,a){"use strict";(function(t){a("4ee8");n(a("66fd"));var e=n(a("9bb1"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])},"1acb":function(t,e,a){"use strict";var n=a("bdfb"),o=a.n(n);o.a},"48e6":function(t,e,a){"use strict";a.r(e);var n=a("8d11"),o=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=o.a},"8d11":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("a34a")),o=i(a("5ad7"));function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e,a,n,o,i,r){try{var s=t[i](r),c=s.value}catch(u){return void a(u)}s.done?e(c):Promise.resolve(c).then(n,o)}function s(t){return function(){var e=this,a=arguments;return new Promise((function(n,o){var i=t.apply(e,a);function s(t){r(i,n,o,s,c,"next",t)}function c(t){r(i,n,o,s,c,"throw",t)}s(void 0)}))}}var c={data:function(){return{qrCode:"",name:"",position:"",palette:"",imagePath:"",loading:!0,formData:{}}},created:function(){""!=this.customerId?this.getUserInfo(this.customerId):(this.formData=this.cardInfo,this.callback())},computed:{cardInfo:function(){return this.$store.state.cardInfo},customerId:function(){return this.$store.state.customerId}},methods:{callback:function(){var t=this.$store.state.isCreatQy;if(""==this.formData.posters_qr_code)this.initData();else{if(t)return this.initData(),!1;this.imagePath=this.formData.posters_qr_code,this.loading=!1}},initData:function(){this.qrCode=this.formData.qr_code,this.name=this.formData.username,this.position=this.formData.position,this.formData.position&&this.formData.main_department?this.formData.positionInfo="".concat(this.formData.position,"/").concat(this.formData.main_department):this.formData.main_department?this.formData.positionInfo=this.formData.main_department:this.formData.positionInfo=this.formData.position,t.showLoading({title:"拼命生成中...",mask:!0}),this.palette=new o.default(this.formData).palette()},onGenerateSuccess:function(e){console.log(e);var a=t.baseUrl,n=this;t.uploadFile({url:a+"/vcard/upload",filePath:e.detail.path,name:"img",header:{token:t.getStorageSync("token")},formData:{id:n.formData.id,type:3},success:function(e){n.loading=!1,t.hideLoading();try{console.log(e),"string"==typeof e.data&&(e.data=JSON.parse(e.data)),n.imagePath=e.data.data.url,n.$store.commit("SetIsCreatQy",!1),n.$store.dispatch("GetCardInfo")}catch(a){console.log(a)}},fail:function(){t.hideLoading(),n.showMsg("error","上传失败")}})},onGenerateError:function(e){t.hideLoading(),console.log(e)},preview:function(){if(!this.imagePath)return!1;var e=[];e.push(this.imagePath),t.previewImage({urls:e,current:0})},saveImg:function(){var e=this;t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.downloadFile({url:e.imagePath,success:function(a){t.saveImageToPhotosAlbum({filePath:a.tempFilePath,success:function(){t.showModal({title:"保存成功",content:"图片已成功保存到相册，你可以长按图片或去手机相册分享给好友",showCancel:!1,success:function(){var a=[];a.push(e.imagePath),t.previewImage({urls:a,current:0})}})}})}})},fail:function(t){t.errMsg.includes("authorize:fail")&&wx.showModal({title:"提示",content:"需要您授权保存相册",showCancel:!1,success:function(t){wx.openSetting({success:function(t){console.log("settingdata",t),t.authSetting["scope.writePhotosAlbum"]?wx.showModal({title:"提示",content:"获取权限成功,再次点击图片即可保存",showCancel:!1}):wx.showModal({title:"提示",content:"获取权限失败，将无法保存到相册哦~",showCancel:!1})},fail:function(t){console.log("failData",t)},complete:function(t){console.log("finishData",t)}})}})}})},getUserInfo:function(t){var e=this;return s(n.default.mark((function a(){var o,i;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$u.api.cardInfo({id:t});case 2:o=a.sent,i=o.data,e.formData=i,e.callback();case 6:case"end":return a.stop()}}),a)})))()}}};e.default=c}).call(this,a("543d")["default"])},"9bb1":function(t,e,a){"use strict";a.r(e);var n=a("f2cd"),o=a("48e6");for(var i in o)"default"!==i&&function(t){a.d(e,t,(function(){return o[t]}))}(i);a("1acb");var r,s=a("f0c5"),c=Object(s["a"])(o["default"],n["b"],n["c"],!1,null,"4889f896",null,!1,n["a"],r);e["default"]=c.exports},bdfb:function(t,e,a){},f2cd:function(t,e,a){"use strict";a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return n}));var n={uSkeleton:function(){return a.e("uview-ui/components/u-skeleton/u-skeleton").then(a.bind(null,"4fdf"))}},o=function(){var t=this,e=t.$createElement;t._self._c},i=[]}},[["06a7","common/runtime","common/vendor"]]]);